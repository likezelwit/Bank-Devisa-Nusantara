<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Card Issuance | BDN Private Banking</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <nav class="navbar">
        <div class="logo">BDN<span>.</span></div>
        <a href="../" class="btn-back">EXIT PRIVILEGE</a>
    </nav>

    <main class="card-container">
        <header class="step-header">
            <span class="step-badge">WORLDWIDE ELITE MEMBERSHIP</span>
            <h1>Pilih Instrumen <br><span class="text-gradient">Finansial Anda.</span></h1>
            <p>Eksklusivitas tanpa batas. Pilih kartu yang mencerminkan status sosial Anda.</p>
        </header>

        <section class="selection-grid">
            <div class="card-option active" onclick="selectCard(this)" data-variant="Platinum Elite">
                <div class="card-preview platinum">
                    <div class="card-chip silver"></div>
                    <div class="card-brand">PLATINUM ELITE</div>
                    <div class="card-number">0810 **** **** ****</div>
                </div>
                <div class="option-details">
                    <h3>Platinum Elite</h3>
                    <p>Standard premium access. Airport lounge worldwide.</p>
                    <span class="price-tag">$499 / Year</span>
                </div>
            </div>

            <div class="card-option" onclick="selectCard(this)" data-variant="Gold Priority">
                <div class="card-preview gold-card">
                    <div class="card-chip gold"></div>
                    <div class="card-brand">GOLD PRIORITY</div>
                    <div class="card-number">0810 **** **** ****</div>
                </div>
                <div class="option-details">
                    <h3>Gold Priority</h3>
                    <p>Priority lane in 150+ countries & 5% cashback.</p>
                    <span class="price-tag">$1,200 / Year</span>
                </div>
            </div>

            <div class="card-option" onclick="selectCard(this)" data-variant="Rose Signature">
                <div class="card-preview rose-gold">
                    <div class="card-chip gold"></div>
                    <div class="card-brand">ROSE SIGNATURE</div>
                    <div class="card-number">0810 **** **** ****</div>
                </div>
                <div class="option-details">
                    <h3>Rose Signature</h3>
                    <p>Exclusive luxury shopping & spa privileges worldwide.</p>
                    <span class="price-tag">$2,500 / Year</span>
                </div>
            </div>

            <div class="card-option" onclick="selectCard(this)" data-variant="Black Signature">
                <div class="card-preview black">
                    <div class="card-chip gold"></div>
                    <div class="card-brand">BLACK SIGNATURE</div>
                    <div class="card-number">0810 **** **** ****</div>
                </div>
                <div class="option-details">
                    <h3>Black Signature</h3>
                    <p>No spending limit. 24/7 Personal Global Concierge.</p>
                    <span class="price-tag">$10,000 / Year</span>
                </div>
            </div>

            <div class="card-option" onclick="selectCard(this)" data-variant="Emerald Private">
                <div class="card-preview emerald">
                    <div class="card-chip gold"></div>
                    <div class="card-brand">EMERALD PRIVATE</div>
                    <div class="card-number">0810 **** **** ****</div>
                </div>
                <div class="option-details">
                    <h3>Emerald Private</h3>
                    <p>Private Jet & Yacht access. Personal Banker 24/7.</p>
                    <span class="price-tag special">$25,000 / Year</span>
                </div>
            </div>

            <div class="card-option" onclick="selectCard(this)" data-variant="Diamond Royal">
                <div class="card-preview diamond">
                    <div class="card-chip gold"></div>
                    <div class="card-brand">DIAMOND ROYAL</div>
                    <div class="card-number">0810 **** **** ****</div>
                </div>
                <div class="option-details">
                    <h3>Diamond Royal</h3>
                    <p>Invitation only. Real diamond embedded on physical card.</p>
                    <span class="price-tag special">$50,000 / Year</span>
                </div>
            </div>
        </section>

        <footer class="action-footer">
            <button id="mainBtn" class="btn-primary" onclick="window.location.href='checkout/'">KONFIRMASI PENERBITAN</button>
        </footer>
    </main>

    <script>
        // Fungsi UI Sederhana (Tetap di sini agar responsif)
        function selectCard(element) {
            // Cek apakah tombol sedang disabled (sudah beli)
            const btn = document.getElementById('mainBtn');
            if (btn.disabled) return;

            document.querySelectorAll('.card-option').forEach(card => card.classList.remove('active'));
            element.classList.add('active');
        }
    </script>

    <script type="module">
        import { db } from "../firebase.js";
        import { ref, onValue } from "https://www.gstatic.com/firebasejs/9.x/firebase-database.js";

        const btn = document.getElementById('mainBtn');
        const grid = document.querySelector('.selection-grid');

        // 1. Cek LocalStorage dulu (Biar instan tanpa nunggu fetch)
        if (localStorage.getItem('diamond_active') === 'true') {
            lockInterface();
        }

        // 2. Sinkronisasi dengan Firebase (Data Akurat/Pusat)
        // Kita asumsikan nomor kartu disimpan di localStorage saat login
        const loggedCard = localStorage.getItem('pending_card'); 

        if (loggedCard) {
            const userRef = ref(db, 'nasabah/' + loggedCard);
            
            onValue(userRef, (snapshot) => {
                const data = snapshot.val();
                if (data && data.cardStatus === "Diamond Royal Active") {
                    localStorage.setItem('diamond_active', 'true'); // Update local jika di DB sudah aktif
                    lockInterface();
                }
            });
        }

        function lockInterface() {
            btn.innerText = "KARTU DIAMOND ANDA AKTIF";
            btn.disabled = true;
            btn.style.background = "#94a3b8";
            btn.style.cursor = "not-allowed";
            btn.onclick = null; // Matikan fungsi pindah halaman
            
            grid.style.filter = "grayscale(0.8)";
            grid.style.pointerEvents = "none";
        }
    </script>
</body>
</html>
