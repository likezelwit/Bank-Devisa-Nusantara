<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyAccount - BANK DEVISA</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #0f172a; 
            --accent: #b8924e; 
            --bg-body: #f1f5f9; 
            --white: #ffffff;
            --gray-100: #f8fafc;
            --gray-200: #e2e8f0;
            --gray-text: #64748b;
            --red: #ef4444;
            --green: #10b981;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-body); color: var(--primary); padding-bottom: calc(80px + var(--safe-area-bottom)); overflow-x: hidden; }

        /* --- CONTAINER & LAYOUT --- */
        .container { max-width: 600px; margin: 0 auto; padding: 20px; position: relative; min-height: 100vh; }
        
        /* --- SVG ICONS UTILITY --- */
        .icon { width: 24px; height: 24px; fill: currentColor; }
        .icon-lg { width: 32px; height: 32px; }
        .icon-text-center { display: flex; align-items: center; justify-content: center; }
        .icon-accent { color: var(--accent); }

        /* --- HEADER --- */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .logo { font-size: 1.2rem; font-weight: 800; letter-spacing: -0.5px; }
        
        /* --- BALANCE CARD (FIXED LOGIC) --- */
        .balance-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 25px;
            border-radius: 24px;
            position: relative;
            box-shadow: 0 20px 40px -5px rgba(15,23,42,0.3);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }

        .card-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-type { font-size: 0.65rem; font-weight: 700; letter-spacing: 1px; color: rgba(255,255,255,0.6); text-transform: uppercase; }
        
        /* Saldo Logic: Flexbox wrap disabled + overflow hidden + JS font sizing */
        .saldo-wrapper {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Align left */
        }
        #saldoNasabah {
            color: var(--accent);
            font-weight: 800;
            display: inline-block;
            /* Ukuran default akan diatur via JS agar presisi */
        }

        .card-footer-row {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .user-info h3 { font-size: 0.9rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
        .user-info p { font-size: 0.7rem; opacity: 0.6; font-family: monospace; letter-spacing: 1px; }

        /* --- MENU GRID --- */
        .section-title { font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 15px 5px; color: var(--gray-text); }
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        
        .feature-card {
            background: var(--white); padding: 15px 10px; border-radius: 20px; text-align: center;
            border: 1px solid var(--gray-200); cursor: pointer; transition: all 0.2s ease;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
        }
        .feature-card:active { transform: scale(0.96); background: var(--gray-100); }
        .feature-card .icon-box { width: 45px; height: 45px; background: var(--gray-100); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; color: var(--primary); }
        .feature-card h3 { font-size: 0.7rem; margin: 0; font-weight: 700; color: var(--primary); }

        /* --- PROMO --- */
        .promo-banner {
            background: linear-gradient(90deg, var(--accent) 0%, #d4a955 100%);
            border-radius: 20px; padding: 20px; margin-top: 25px;
            display: flex; align-items: center; justify-content: space-between;
            color: white; box-shadow: 0 10px 20px -5px rgba(184, 146, 78, 0.4);
        }
        .promo-btn { background: white; border: none; padding: 8px 16px; border-radius: 10px; font-weight: 700; font-size: 0.75rem; color: var(--primary); cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }

        /* --- SPA PAGES --- */
        .spa-page { display: none; animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .spa-page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* Detail Header for Sub-pages */
        .detail-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .btn-back { background: white; border: 1px solid var(--gray-200); border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .btn-back:active { background: var(--gray-100); transform: scale(0.9); }

        /* --- BOTTOM NAVIGATION --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid var(--gray-200);
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 20px calc(10px + var(--safe-area-bottom));
            z-index: 100;
            padding-bottom: max(10px, var(--safe-area-bottom));
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--gray-text); text-decoration: none; cursor: pointer;
            transition: 0.3s; width: 60px; position: relative;
        }
        .nav-item svg { margin-bottom: 4px; transition: 0.3s; }
        .nav-item span { font-size: 0.65rem; font-weight: 600; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active svg { transform: translateY(-3px); color: var(--accent); }

        /* Floating QR Button (Special) */
        .qr-btn-wrapper { 
            position: relative; top: -25px; 
            background: var(--primary); 
            border: 4px solid var(--bg-body); /* Creates gap */
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(15,23,42,0.2);
        }
        .qr-btn {
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .qr-btn svg { width: 30px; height: 30px; color: var(--accent); }
        .qr-btn:active { transform: scale(0.95); }

        /* Utility Helpers */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <script>
        // Simple Auth Check
        if(!localStorage.getItem('userCard')) window.location.href = '../index.html';
    </script>

    <div class="container">
        
        <!-- HEADER -->
        <header>
            <div class="logo">BANK<span style="color: var(--accent);">DEVISA</span></div>
            <div style="display: flex; gap: 15px;">
                <button id="btnLogout" style="background:none; border:none; cursor:pointer;">
                    <svg class="icon" style="color: var(--red);" viewBox="0 0 24 24"><path d="M16 17v-3H9v-4h7V7l5 5-5 5M14 2a2 2 0 012 2v2h-2V4H6v16h8v-2h2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2h8z"/></svg>
                </button>
            </div>
        </header>

        <!-- === PAGE: DASHBOARD === -->
        <div id="page-home" class="spa-page active">
            <div class="balance-card">
                <div class="card-header-row">
                    <span class="card-type">Tabungan Utama</span>
                    <!-- Wifi Icon SVG -->
                    <svg class="icon" style="opacity:0.7" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21L2 9h5l5-6 5 6h5L12 21zm0-3.5l4.5-5.5H16L12 7.5 8 12H7.5L12 17.5zM12 3l-2 2.5 2 2.5 2-2.5L12 3z"/></svg>
                </div>
                
                <div class="saldo-wrapper" id="saldoContainer">
                    <h2 id="saldoNasabah">Loading...</h2>
                </div>

                <div class="card-footer-row">
                    <div class="user-info">
                        <h3 id="namaNasabah">Loading...</h3>
                        <p id="nomorKartu">**** **** **** ****</p>
                    </div>
                    <!-- Mastercard SVG -->
                    <svg width="45" height="30" viewBox="0 0 48 32"><circle cx="17" cy="16" r="12" fill="#EB001B"/><circle cx="31" cy="16" r="12" fill="#F79E1B"/><path fill="#FF5F00" d="M24 8.5a12 12 0 000 15 12 12 0 000-15z"/></svg>
                </div>
            </div>

            <div class="section-title">Layanan</div>
            <div class="menu-grid">
                <div class="feature-card" onclick="openSPA('page-transfer')">
                    <div class="icon-box">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M2 12h20M12 2v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                    </div>
                    <h3>Transfer</h3>
                </div>
                <div class="feature-card" onclick="openSPA('page-topup')">
                    <div class="icon-box">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l2 4h-4l2-4zm0 20l-2-4h4l-2 4zM2 12l4 2v-4l-4 2zm20 0l-4-2v4l4-2z"/></svg>
                    </div>
                    <h3>Top Up</h3>
                </div>
                <div class="feature-card" onclick="alert('Fitur ini belum tersedia')">
                    <div class="icon-box">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                    </div>
                    <h3>Tagihan</h3>
                </div>
                <div class="feature-card" onclick="alert('Fitur ini belum tersedia')">
                    <div class="icon-box">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                    </div>
                    <h3>Lainnya</h3>
                </div>
            </div>

            <div class="section-title">Investasi & Pinjaman</div>
            <div class="menu-grid">
                <div class="feature-card" onclick="openSPA('page-invest')">
                    <div class="icon-box" style="background:#ecfdf5; color:var(--green);">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
                    </div>
                    <h3>Investasi</h3>
                </div>
                <div class="feature-card" onclick="openSPA('page-loan')">
                    <div class="icon-box" style="background:#fff1f2; color:var(--red);">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M5 13h14v-2H5v2zm-2 4h14v-2H3v2zM7 7v2h14V7H7z"/></svg>
                    </div>
                    <h3>Pinjaman</h3>
                </div>
            </div>

            <div class="promo-banner">
                <div>
                    <h4 style="font-size: 0.9rem; margin-bottom: 4px;">Rewards Platinum</h4>
                    <p style="font-size: 0.7rem; opacity: 0.9;">Klaim poin reward Anda sekarang!</p>
                </div>
                <button class="promo-btn">Klaim</button>
            </div>
        </div>

        <!-- === PAGE: TRANSFER (SPA) === -->
        <div id="page-transfer" class="spa-page">
            <div class="detail-header">
                <button class="btn-back" onclick="openSPA('page-home')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <h2 style="font-size: 1.2rem;">Transfer Dana</h2>
            </div>
            
            <div style="background:white; padding:20px; border-radius:20px; border:1px solid var(--gray-200);">
                <div class="section-title" style="margin-left:-5px;">Pilih Tujuan</div>
                <div class="menu-grid">
                    <div class="feature-card">
                        <div class="icon-box"><svg class="icon" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
                        <h3>Sesama</h3>
                    </div>
                    <div class="feature-card">
                        <div class="icon-box"><svg class="icon" viewBox="0 0 24 24"><path d="M15 4v2h3v12h-3v2h5V4h-5zM9 18v-2H6V4h3V2H4v16h5z"/></svg></div>
                        <h3>Antar Bank</h3>
                    </div>
                </div>
                <div style="margin-top:20px;">
                    <label style="font-size:0.8rem; font-weight:700; color:var(--gray-text); display:block; margin-bottom:8px;">Nomor Rekening</label>
                    <input type="number" placeholder="Contoh: 0810..." style="width:100%; padding:15px; border:1px solid var(--gray-200); border-radius:12px; font-size:1rem; font-family:inherit;">
                </div>
            </div>
        </div>

        <!-- === PAGE: TOP UP (SPA) === -->
        <div id="page-topup" class="spa-page">
            <div class="detail-header">
                <button class="btn-back" onclick="openSPA('page-home')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <h2 style="font-size: 1.2rem;">Isi Ulang</h2>
            </div>
            <div class="menu-grid" style="grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <div class="feature-card" style="padding:10px;"><h3>Pulsa</h3></div>
                <div class="feature-card" style="padding:10px;"><h3>Data</h3></div>
                <div class="feature-card" style="padding:10px;"><h3>PLN</h3></div>
                <div class="feature-card" style="padding:10px;"><h3>E-Wallet</h3></div>
                <div class="feature-card" style="padding:10px;"><h3>Game</h3></div>
                <div class="feature-card" style="padding:10px;"><h3>Streaming</h3></div>
            </div>
        </div>

        <!-- === PAGE: INVESTASI (SPA) === -->
        <div id="page-invest" class="spa-page">
            <div class="detail-header">
                <button class="btn-back" onclick="openSPA('page-home')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <h2 style="font-size: 1.2rem;">Portofolio</h2>
            </div>
            <div style="background:var(--primary); color:white; padding:20px; border-radius:20px; margin-bottom:20px;">
                <p style="font-size:0.7rem; opacity:0.7;">TOTAL ASET</p>
                <h2 style="font-size:1.8rem; margin:10px 0; color:var(--accent);">Rp 12.500.000</h2>
                <div style="display:flex; align-items:center; gap:5px; font-size:0.8rem; color:#4ade80;">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M7 14l5-5 5 5z"/></svg>
                    <span>+2.4% bulan ini</span>
                </div>
            </div>
            <div class="feature-card" style="flex-direction:row; justify-content:space-between; padding:15px 20px; margin-bottom:10px; text-align:left;">
                <div>
                    <h3 style="font-size:1rem; margin-bottom:2px;">RD Pasar Uang</h3>
                    <span style="font-size:0.7rem; color:var(--gray-text);">Stabil & Likuid</span>
                </div>
                <div style="font-size:0.9rem; font-weight:700;">Rp 5.000.000</div>
            </div>
        </div>

        <!-- === PAGE: PINJAMAN (SPA) === -->
        <div id="page-loan" class="spa-page">
            <div class="detail-header">
                <button class="btn-back" onclick="openSPA('page-home')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <h2 style="font-size: 1.2rem;">Pinjaman</h2>
            </div>
            <div style="background:var(--white); padding:20px; border-radius:20px; border:1px solid var(--gray-200); text-align:center;">
                <p style="font-size:0.7rem; color:var(--gray-text); font-weight:700;">LIMIT TERSEDIA</p>
                <h2 style="font-size:1.8rem; margin:10px 0; color:var(--primary);">Rp 50.000.000</h2>
                <button style="background:var(--primary); color:white; border:none; padding:12px 30px; border-radius:15px; font-weight:700; width:100%;">Ajukan Sekarang</button>
            </div>
        </div>

        <!-- === PAGE: ACCOUNT (SPA) === -->
        <div id="page-account" class="spa-page">
            <div class="detail-header">
                <h2 style="font-size: 1.2rem;">Profil Saya</h2>
            </div>
            <div style="text-align:center; margin-bottom:30px;">
                <div style="width:80px; height:80px; background:var(--gray-200); border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                    <svg class="icon-lg" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
                <h3 id="accName" style="font-size:1.1rem; font-weight:700;">User</h3>
                <p id="accCard" style="font-size:0.8rem; color:var(--gray-text); font-family:monospace;">Card</p>
            </div>
            <div style="background:white; border-radius:20px; border:1px solid var(--gray-200); overflow:hidden;">
                <div class="feature-card" style="flex-direction:row; justify-content:space-between; padding:15px 20px; border-radius:0; border-bottom:1px solid var(--gray-100); text-align:left;">
                    <span style="font-size:0.9rem; font-weight:600;">Pengaturan Akun</span>
                    <svg class="icon" style="color:var(--gray-text);" viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
                </div>
                <div class="feature-card" style="flex-direction:row; justify-content:space-between; padding:15px 20px; border-radius:0; border-bottom:1px solid var(--gray-100); text-align:left;">
                    <span style="font-size:0.9rem; font-weight:600;">Kartu Saya</span>
                    <svg class="icon" style="color:var(--gray-text);" viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
                </div>
                <div class="feature-card" style="flex-direction:row; justify-content:space-between; padding:15px 20px; border-radius:0; text-align:left;">
                    <span style="font-size:0.9rem; font-weight:600; color:var(--red);">Keluar</span>
                    <svg class="icon" style="color:var(--red);" viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                </div>
            </div>
        </div>

    </div>

    <!-- === BOTTOM NAVIGATION === -->
    <div class="bottom-nav">
        <!-- Kiri: Account -->
        <a class="nav-item" id="nav-account" onclick="openSPA('page-account')">
            <svg class="icon" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span>Akun</span>
        </a>

        <!-- Tengah: QR (Floating) -->
        <div class="nav-item" style="width:auto;">
            <div class="qr-btn-wrapper">
                <div class="qr-btn">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm13-2h3v2h-3v-2zm-3 0h2v2h-2v-2zm3 3h3v2h-3v-2zm-3 0h2v2h-2v-2zm3 3h3v2h-3v-2zm-3 0h2v2h-2v-2zM13 13h2v2h-2v-2zm0 3h2v2h-2v-2z"/></svg>
                </div>
            </div>
        </div>

        <!-- Kanan: Home (Aktif Default) -->
        <a class="nav-item active" id="nav-home" onclick="openSPA('page-home')">
            <svg class="icon" viewBox="0 0 24 24"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>Home</span>
        </a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, get, child, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDXYDqFmhO8nacuX-hVnNsXMmpeqwYlW7U",
            databaseURL: "https://wifist-d3588-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "wifist-d3588"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- SPA NAVIGATION LOGIC ---
        window.openSPA = (pageId) => {
            // Hide all pages
            document.querySelectorAll('.spa-page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));

            // Show target page
            const target = document.getElementById(pageId);
            if(target) target.classList.add('active');

            // Update Bottom Nav Active State
            if(pageId === 'page-home') document.getElementById('nav-home').classList.add('active');
            if(pageId === 'page-account') document.getElementById('nav-account').classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- DYNAMIC SALDO LOGIC (FONT SIZING) ---
        function adjustSaldoFontSize(text) {
            const elem = document.getElementById('saldoNasabah');
            const len = text.length;
            
            // Logika Penyesuaian Font berdasarkan panjang string
            // Batas lebar kartu sekitar 300-350px di mobile
            if (len > 22) { 
                elem.style.fontSize = "1.1rem"; 
            } else if (len > 18) { 
                elem.style.fontSize = "1.4rem"; 
            } else if (len > 14) { 
                elem.style.fontSize = "1.8rem"; 
            } else { 
                elem.style.fontSize = "2.4rem"; 
            }
        }

        async function initDashboard() {
            const card = localStorage.getItem('userCard');
            if (!card) return;
            
            try {
                const snap = await get(child(ref(db), `nasabah/${card}`));
                
                if(snap.exists()) {
                    const data = snap.val();
                    if (data.MyAccount !== "active") { handleLogout(); return; }

                    // Set User Info
                    document.getElementById('namaNasabah').innerText = data.nama || data.name || "Nasabah";
                    document.getElementById('nomorKartu').innerText = card.replace(/.{4}/g, '$& ');
                    
                    // Account Page Info
                    document.getElementById('accName').innerText = data.nama || "Nasabah";
                    document.getElementById('accCard').innerText = card;

                    // Set Saldo Logic
                    const saldoRaw = data.saldo || 0;
                    const country = data.country || "ID"; 
                    let formattedSaldo = "";

                    if(country === "US") {
                        const kurs = 16666; 
                        const saldoUSD = saldoRaw / kurs;
                        formattedSaldo = new Intl.NumberFormat('en-US', {
                            style: 'currency', currency: 'USD', minimumFractionDigits: 2
                        }).format(saldoUSD);
                    } else {
                        formattedSaldo = new Intl.NumberFormat('id-ID', {
                            style: 'currency', currency: 'IDR', maximumFractionDigits: 0
                        }).format(saldoRaw);
                    }

                    // Apply Font Logic
                    const saldoElem = document.getElementById('saldoNasabah');
                    saldoElem.innerText = formattedSaldo;
                    adjustSaldoFontSize(formattedSaldo);

                } else {
                    handleLogout();
                }
            } catch (err) {
                console.error("Error loading dashboard:", err);
            }
        }

        async function handleLogout() {
            const card = localStorage.getItem('userCard');
            if (card) {
                try { await update(ref(db, `nasabah/${card}`), { MyAccount: "nonactive" }); } catch (e) {}
            }
            localStorage.clear();
            window.location.href = '../index.html';
        }

        document.getElementById('btnLogout').onclick = handleLogout;
        initDashboard();
    </script>
</body>
</html>
